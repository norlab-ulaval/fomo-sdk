Bootstrap: docker
From: python:3.10-slim

%post
    apt-get update && apt-get install -y --no-install-recommends \
        git wget ffmpeg libsm6 libxext6 libgl1 \
        build-essential ca-certificates curl \
        && rm -rf /var/lib/apt/lists/*

    pip install --no-cache-dir --upgrade pip setuptools wheel

    pip install --no-cache-dir \
        torch==2.3.1+cu121 torchvision==0.18.1+cu121 \
        --index-url https://download.pytorch.org/whl/cu121

    pip install --no-cache-dir \
        moviepy==1.0.3 \
        numpy==1.24.3 \
        ffmpeg-python==0.2.0 \
        opencv-python-headless==4.7.0.72

%environment
    export PYTHONPATH=/mnt/egoblur:$PYTHONPATH
    export LC_ALL=C.UTF-8
    export LANG=C.UTF-8

%runscript
    cd /mnt/egoblur
    exec /bin/bash
